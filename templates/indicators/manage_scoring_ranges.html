<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–ø–∞–∑–æ–Ω—ã –æ—Ü–µ–Ω–æ–∫ - {{ indicator.name }}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .indicator-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        .indicator-info h3 {
            margin: 0 0 15px 0;
            font-size: 24px;
            font-weight: 700;
        }
        .indicator-info p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .form-section {
            background: linear-gradient(135deg, #f8f9ff, #fff);
            border: 2px solid #e3f2fd;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        .form-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-section h3::before {
            content: '‚ûï';
            font-size: 24px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: block;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius-small);
            font-size: 14px;
            transition: var(--transition);
            box-sizing: border-box;
        }
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .checkbox-group {
            display: flex;
            gap: 25px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        .ranges-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        .ranges-table th {
            background: var(--primary-gradient);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: left;
        }
        .ranges-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        .ranges-table tr:last-child td {
            border-bottom: none;
        }
        .ranges-table tr:hover {
            background: #f8f9ff;
        }
        .range-display {
            font-family: 'Courier New', monospace;
            background: var(--info-gradient);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 13px;
            display: inline-block;
        }
        .score-badge {
            background: var(--warning-gradient);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 13px;
        }
        .example-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }
        .example-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: #856404;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .example-title::before {
            content: 'üí°';
            font-size: 20px;
        }
        .help-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
            font-style: italic;
        }
        .no-ranges {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        .no-ranges-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="page-header">
        <h1 class="page-title">üéØ –î–∏–∞–ø–∞–∑–æ–Ω—ã –æ—Ü–µ–Ω–æ–∫</h1>
        <p class="page-subtitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤ –¥–ª—è "{{ indicator.name }}"</p>
        
        <nav class="nav-bar mt-20">
            <a href="/" class="nav-link">üè† –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
            <a href="/patients/" class="nav-link">üë• –ü–∞—Ü–∏–µ–Ω—Ç—ã</a>
            <a href="/indicators/" class="nav-link">üìä –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏</a>
            <a href="/schemas/" class="nav-link">üìã –°—Ö–µ–º—ã</a>
        </nav>
    </header>

    <div class="main-container">
        <!-- Messages Section -->
        {% include 'components/messages.html' %}

        <div class="card fade-in-up">
            <div class="card-body">
                <div class="indicator-info">
                    <h3>üìä {{ indicator.name }}</h3>
                    <p><strong>–°—Ö–µ–º–∞:</strong> {{ indicator.schema.name|default:"–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞" }}</p>
                    <p><strong>–î–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π:</strong> {{ indicator.min_value|default:"N/A" }} - {{ indicator.max_value|default:"N/A" }}</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ indicator.description|default:"–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è" }}</p>
                </div>

                <div class="example-box">
                    <div class="example-title">–ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –æ—Ü–µ–Ω–æ–∫</div>
                    <strong>OHIP 14:</strong> 0-28=0–±, 29-42=1–±, 43-56=2–±<br>
                    <strong>–ö—É—Ä–µ–Ω–∏–µ:</strong> 0=0–± (—Ç–æ—á–Ω–æ–µ), 1-19=1–± (–¥–∏–∞–ø–∞–∑–æ–Ω), ‚â•20=2–± (–±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ)<br>
                    <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> <65=0–± (–º–µ–Ω—å—à–µ), ‚â•65=1–± (–±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ)
                </div>

                <div class="form-section">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω</h3>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="add_range">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="score">–ë–∞–ª–ª—ã (0-3) *</label>
                                <input type="number" name="score" id="score" class="form-control" min="0" max="3" required>
                                <div class="help-text">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –∑–∞ —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω</div>
                            </div>
                            <div class="form-group">
                                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                                <input type="text" name="description" id="description" class="form-control" 
                                       placeholder="–Ω–∞–ø—Ä., '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫', '‚â•20 —Å–∏–≥–∞—Ä–µ—Ç', '–ù–µ –∫—É—Ä–∏—Ç'" required>
                                <div class="help-text">–ü–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="min_value">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="min_value" id="min_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ 0-28 –≤–≤–µ–¥–∏—Ç–µ 0</div>
                            </div>
                            <div class="form-group">
                                <label for="max_value">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="max_value" id="max_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ 0-28 –≤–≤–µ–¥–∏—Ç–µ 28</div>
                            </div>
                            <div class="form-group">
                                <label for="exact_value">–¢–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="exact_value" id="exact_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∫–∞–∫ "0 —Å–∏–≥–∞—Ä–µ—Ç"</div>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" name="is_greater_than_or_equal"> 
                                –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ (‚â•) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –º–∏–Ω. –∑–Ω–∞—á–µ–Ω–∏–µ–º
                            </label>
                            <label>
                                <input type="checkbox" name="is_less_than"> 
                                –ú–µ–Ω—å—à–µ (<) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –º–∞–∫—Å. –∑–Ω–∞—á–µ–Ω–∏–µ–º
                            </label>
                        </div>

                        <div style="margin-top: 25px;">
                            <button type="submit" class="btn btn-success">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card-header">
                    <h3>üéØ –¢–µ–∫—É—â–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –æ—Ü–µ–Ω–æ–∫</h3>
                </div>
                
                {% if scoring_ranges %}
                    <table class="ranges-table">
                        <thead>
                            <tr>
                                <th>–ë–∞–ª–ª—ã</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for range in scoring_ranges %}
                                <tr>
                                    <td><span class="score-badge">{{ range.score }} –±</span></td>
                                    <td>{{ range.description }}</td>
                                    <td>
                                        <span class="range-display">
                                            {% if range.exact_value is not None %}
                                                = {{ range.exact_value }}
                                            {% elif range.is_greater_than_or_equal and range.min_value is not None %}
                                                ‚â• {{ range.min_value }}
                                            {% elif range.is_less_than and range.max_value is not None %}
                                                < {{ range.max_value }}
                                            {% elif range.min_value is not None and range.max_value is not None %}
                                                {{ range.min_value }} - {{ range.max_value }}
                                            {% elif range.min_value is not None %}
                                                ‚â• {{ range.min_value }}
                                            {% elif range.max_value is not None %}
                                                ‚â§ {{ range.max_value }}
                                            {% else %}
                                                –ù–µ–≤–µ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <form method="post" style="display: inline;">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete_range">
                                            <input type="hidden" name="range_id" value="{{ range.id }}">
                                            <button type="submit" class="btn btn-danger btn-sm" 
                                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω?')">
                                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="no-ranges">
                        <div class="no-ranges-icon">üéØ</div>
                        <h3>–î–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –≤—ã—à–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞</p>
                    </div>
                {% endif %}

                <div style="margin-top: 30px; text-align: center;">
                    <a href="/indicators/" class="btn btn-secondary">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>