<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–ø–∞–∑–æ–Ω—ã –æ—Ü–µ–Ω–æ–∫ - {{ indicator.name }}</title>
    <link rel="stylesheet" href="/static/css/modern-medical.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .indicator-info {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: var(--white);
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-md);
        }
        .indicator-info h3 {
            margin: 0 0 var(--space-4) 0;
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--white);
        }
        .indicator-info p {
            margin: var(--space-1) 0;
            opacity: 0.9;
        }
        .form-section {
            background: var(--white);
            border: 2px solid var(--primary-light);
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow);
        }
        .form-section h3 {
            color: var(--primary);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .form-section h3::before {
            content: '‚ûï';
            font-size: var(--font-size-xl);
        }
        .checkbox-group {
            display: flex;
            gap: var(--space-6);
            margin: var(--space-4) 0;
            flex-wrap: wrap;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            cursor: pointer;
            font-weight: 500;
        }
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        .range-display {
            font-family: 'Courier New', monospace;
            background: var(--primary);
            color: var(--white);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--font-size-xs);
            display: inline-block;
        }
        .score-badge {
            background: var(--warning);
            color: var(--white);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--font-size-xs);
        }
        .example-box {
            background: var(--warning-light);
            border: 2px solid var(--warning);
            padding: var(--space-5);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
        }
        .example-title {
            font-weight: 700;
            margin-bottom: var(--space-4);
            color: #856404;
            font-size: var(--font-size-base);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .example-title::before {
            content: 'üí°';
            font-size: var(--font-size-lg);
        }
        .no-ranges {
            text-align: center;
            padding: var(--space-16) var(--space-5);
            color: var(--gray-500);
        }
        .no-ranges-icon {
            font-size: 4rem;
            margin-bottom: var(--space-5);
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">
                    <span class="logo-icon">ü¶∑</span>
                    <span>–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞</span>
                </a>
                
                <nav class="nav">
                    <a href="/" class="nav-link">üè† –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                    <a href="/patients/" class="nav-link">üë• –í—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã</a>
                    <a href="/indicators/" class="nav-link active">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                    <a href="/schemas/" class="nav-link">üìã –°—Ö–µ–º—ã</a>
                    <a href="/auth/logout/" class="btn btn-danger btn-sm">üö™ –í—ã—Ö–æ–¥</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Messages Section -->
        {% include 'components/messages.html' %}

        <div class="card">
            <div class="card-body">
                <div class="indicator-info">
                    <h3>üìä {{ indicator.name }}</h3>
                    <p><strong>–°—Ö–µ–º–∞:</strong> {{ indicator.schema.name|default:"–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞" }}</p>
                    <p><strong>–î–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π:</strong> {{ indicator.min_value|default:"N/A" }} - {{ indicator.max_value|default:"N/A" }}</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ indicator.description|default:"–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è" }}</p>
                </div>

                <div class="example-box">
                    <div class="example-title">–ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –æ—Ü–µ–Ω–æ–∫</div>
                    <strong>OHIP 14:</strong> 0-28=0–±, 29-42=1–±, 43-56=2–±<br>
                    <strong>–ö—É—Ä–µ–Ω–∏–µ:</strong> 0=0–± (—Ç–æ—á–Ω–æ–µ), 1-19=1–± (–¥–∏–∞–ø–∞–∑–æ–Ω), ‚â•20=2–± (–±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ)<br>
                    <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> <65=0–± (–º–µ–Ω—å—à–µ), ‚â•65=1–± (–±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ)
                </div>

                <div class="form-section">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω</h3>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="add_range">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="score">–ë–∞–ª–ª—ã (0-3) *</label>
                                <input type="number" name="score" id="score" class="form-control" min="0" max="3" required>
                                <div class="help-text">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –∑–∞ —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω</div>
                            </div>
                            <div class="form-group">
                                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                                <input type="text" name="description" id="description" class="form-control" 
                                       placeholder="–Ω–∞–ø—Ä., '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫', '‚â•20 —Å–∏–≥–∞—Ä–µ—Ç', '–ù–µ –∫—É—Ä–∏—Ç'" required>
                                <div class="help-text">–ü–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="min_value">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="min_value" id="min_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ 0-28 –≤–≤–µ–¥–∏—Ç–µ 0</div>
                            </div>
                            <div class="form-group">
                                <label for="max_value">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="max_value" id="max_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ 0-28 –≤–≤–µ–¥–∏—Ç–µ 28</div>
                            </div>
                            <div class="form-group">
                                <label for="exact_value">–¢–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                <input type="number" name="exact_value" id="exact_value" class="form-control" step="0.1">
                                <div class="help-text">–î–ª—è —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∫–∞–∫ "0 —Å–∏–≥–∞—Ä–µ—Ç"</div>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" name="is_greater_than_or_equal"> 
                                –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ (‚â•) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –º–∏–Ω. –∑–Ω–∞—á–µ–Ω–∏–µ–º
                            </label>
                            <label>
                                <input type="checkbox" name="is_less_than"> 
                                –ú–µ–Ω—å—à–µ (<) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –º–∞–∫—Å. –∑–Ω–∞—á–µ–Ω–∏–µ–º
                            </label>
                        </div>

                        <div class="d-flex gap-2 justify-content-end mt-4">
                            <button type="submit" class="btn btn-success">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card-header">
                    <h3>üéØ –¢–µ–∫—É—â–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –æ—Ü–µ–Ω–æ–∫</h3>
                </div>
                
                {% if scoring_ranges %}
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–ë–∞–ª–ª—ã</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for range in scoring_ranges %}
                                    <tr>
                                        <td><span class="score-badge">{{ range.score }} –±</span></td>
                                        <td>{{ range.description }}</td>
                                        <td>
                                            <span class="range-display">
                                                {% if range.exact_value is not None %}
                                                    = {{ range.exact_value }}
                                                {% elif range.is_greater_than_or_equal and range.min_value is not None %}
                                                    ‚â• {{ range.min_value }}
                                                {% elif range.is_less_than and range.max_value is not None %}
                                                    < {{ range.max_value }}
                                                {% elif range.min_value is not None and range.max_value is not None %}
                                                    {{ range.min_value }} - {{ range.max_value }}
                                                {% elif range.min_value is not None %}
                                                    ‚â• {{ range.min_value }}
                                                {% elif range.max_value is not None %}
                                                    ‚â§ {{ range.max_value }}
                                                {% else %}
                                                    –ù–µ–≤–µ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
                                                {% endif %}
                                            </span>
                                        </td>
                                        <td>
                                            <form method="post" style="display: inline;">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="delete_range">
                                                <input type="hidden" name="range_id" value="{{ range.id }}">
                                                <button type="submit" class="btn btn-danger btn-sm" 
                                                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω?')">
                                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="no-ranges">
                        <div class="no-ranges-icon">üéØ</div>
                        <h3>–î–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –≤—ã—à–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞</p>
                    </div>
                {% endif %}

                <div class="d-flex gap-2 justify-content-center mt-4">
                    <a href="/indicators/" class="btn btn-secondary">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>