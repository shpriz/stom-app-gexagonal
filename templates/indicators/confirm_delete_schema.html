<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã - {{ schema.name }}</title>
    <link rel="stylesheet" href="/static/css/modern-medical.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-container {
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            border: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            border: none;
        }
        .alert-danger {
            border-left: 4px solid #dc3545;
        }
        .data-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #dc3545;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <strong>‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–∏—Ç —Å—Ö–µ–º—É –∏ –í–°–ï —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å!
                </div>
                
                <div class="data-section">
                    <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ö–µ–º–µ:</h5>
                    <ul class="list-unstyled">
                        <li><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {{ schema.name }}</li>
                        {% if schema.description %}
                        <li><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ schema.description }}</li>
                        {% endif %}
                        <li><strong>–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong> {{ schema.order }}</li>
                        <li><strong>–°—Ç–∞—Ç—É—Å:</strong> {% if schema.is_active %}–ê–∫—Ç–∏–≤–Ω–∞{% else %}–ù–µ–∞–∫—Ç–∏–≤–Ω–∞{% endif %}</li>
                        <li><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> {{ schema.created_at|date:"d.m.Y H:i"|default:"N/A" }}</li>
                        <li><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ schema.updated_at|date:"d.m.Y H:i"|default:"N/A" }}</li>
                    </ul>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ indicator_count }}</div>
                        <div class="stat-label">–ü–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ measurement_count }}</div>
                        <div class="stat-label">–ó–Ω–∞—á–µ–Ω–∏–π –∏–∑–º–µ—Ä–µ–Ω–∏–π</div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <h6><strong>–°–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–µ–Ω—ã:</strong></h6>
                    <ul class="mb-0">
                        <li>–°—Ö–µ–º–∞ "{{ schema.name }}" –∏ –µ—ë –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
                        {% if indicator_count > 0 %}
                        <li>{{ indicator_count }} –ø–æ–∫–∞–∑–∞—Ç–µ–ª{% if indicator_count == 1 %}—å{% elif indicator_count < 5 %}—è{% else %}–µ–π{% endif %} —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</li>
                        {% endif %}
                        {% if measurement_count > 0 %}
                        <li>{{ measurement_count }} –∑–Ω–∞—á–µ–Ω–∏{% if measurement_count == 1 %}–µ{% elif measurement_count < 5 %}—è{% else %}–π{% endif %} –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</li>
                        {% endif %}
                        <li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π —Å—Ö–µ–º–æ–π</li>
                        <li>–õ—é–±—ã–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –æ—Ç—á–µ—Ç—ã</li>
                    </ul>
                </div>

                {% if measurement_count > 0 %}
                <div class="alert alert-info">
                    <strong>üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:</strong> –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ö–µ–º—ã –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º, –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å–∏ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–ª–∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏.
                </div>
                {% endif %}

                <p class="text-danger fw-bold">
                    –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã: <strong>"{{ schema.name }}"</strong>
                </p>

                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="confirmation" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è:</label>
                        <input type="text" class="form-control" id="confirmation" name="confirmation" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ: {{ schema.name }}" 
                               autocomplete="off" required>
                    </div>
                    
                    <div class="d-flex gap-2 justify-content-end mt-4">
                        <a href="/schemas/" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>
                            –û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-danger" id="deleteButton" disabled onclick="return confirm('–≠—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–∏—Ç {{ schema.name }} –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –í—ã —É–≤–µ—Ä–µ–Ω—ã?')">
                            <i class="fas fa-trash me-1"></i>
                            –î–∞, —É–¥–∞–ª–∏—Ç—å —Å—Ö–µ–º—É –Ω–∞–≤—Å–µ–≥–¥–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const confirmationInput = document.getElementById('confirmation');
            const deleteButton = document.getElementById('deleteButton');
            const schemaName = "{{ schema.name }}";
            
            // Auto-focus on confirmation input
            confirmationInput.focus();
            
            // Enable delete button only when correct name is entered
            confirmationInput.addEventListener('input', function() {
                const isValid = this.value.trim() === schemaName;
                deleteButton.disabled = !isValid;
                
                if (isValid) {
                    deleteButton.style.opacity = '1';
                    deleteButton.style.cursor = 'pointer';
                } else {
                    deleteButton.style.opacity = '0.5';
                    deleteButton.style.cursor = 'not-allowed';
                }
            });
            
            // Final confirmation on form submit
            document.getElementById('deleteForm').addEventListener('submit', function(e) {
                if (confirmationInput.value.trim() !== schemaName) {
                    e.preventDefault();
                    alert('–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –≤–≤–µ–¥–µ–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ!');
                    confirmationInput.focus();
                    return false;
                }
            });
        });
    </script>
</body>
</html>